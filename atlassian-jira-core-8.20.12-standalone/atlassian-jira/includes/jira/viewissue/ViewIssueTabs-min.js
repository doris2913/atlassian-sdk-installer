define("jira/viewissue/tabs",["jira/util/logger","jira/util/formatter","jquery","jira/jquery/deferred","jira/util/data/meta","jira/dialog/form-dialog","jira/ajs/ajax/smart-ajax","jira/userhover/userhover","jira/viewissue/tabs/analytics"],function(t,e,a,i,n,r,s,o,u){"use strict";function c(t){t=t||document,a.each(_,function(e,a){a(t)})}function l(t){var e=a(t).find(".issuePanelWrapper"),i=a(t).find("#issue_actions_container");T=i.length?i:T,C=e.length?e:C}function f(t,e){var a=new r({id:"issue-tab-error-dialog",widthClass:"small",content:s.buildDialogErrorContent(t,!1)});d(e),T.show(),a.show()}function d(t){a("#issue-tabs li").each(function(){var e=a(this),i=e.data("key"),n=e.data("label");if(i===t)e.addClass("active"),e.html(R.label({text:n}));else{e.removeClass("active");var r=e.data("id"),s=e.data("href");e.html(R.tab({id:r,href:s,linkClass:I,text:n}))}}),m(a("#issue-tabs"))}function h(t){d(t)}function v(t,e){var a=t.pageX,i=t.pageY,n=e.offset(),r=e.outerWidth(),s=e.outerHeight();return 0===a&&0===i||!(a>=n.left&&a<=n.left+r&&i>=n.top&&i<=n.top+s)}function m(t){var e=a(t).find("li.active").data("key");a(t).find(S).click(function(t){var i=a(this),n=v(t,i),r=i.parent().data("key"),s=t.metaKey;r?u.tabClicked(i,s,n):u.buttonClicked(i,s,n),s||(t.preventDefault(),r&&h(r),p(e,i.attr("href")).done(function(t){n&&(r?t.find("#"+i.attr("id")+" > :first-child").focus():t.find(".sortwrap  > :first-child").focus())}).done(c))})}function p(e,n){var r=i();q&&q.abort();var o=s.makeRequest({jqueryAjaxFn:F?a.pjax:a.ajax,headers:{"X-PJAX":!0},container:J,url:n,timeout:null,complete:function(i,n,s){if("abort"!==n){if(q=null,!s.successful)return void((s.status<300||s.status>=400)&&f(s,e));var o=a(this.container),u=document.createElement("div");u.innerHTML=s.data;var c=document.createDocumentFragment().appendChild(u);F||b(o,c),t.trace("jira.issue.tab.loaded"),r.resolve(o)}}});return a(o).throbber({target:C}),q=o,r}function b(t,e){var i=e.querySelectorAll(".tabwrap"),n=t.find(".tabwrap"),r=a(e.querySelectorAll("#issue_actions_container")).contents(),s=T.contents();if(i.length&&n.length&&r.length&&s.length){n.replaceWith(i),T.stop(!0,!0);var o=T.height();T.append(r);var u=T.height()-o,c=o-u;c>0?(T.css("height",u+c),s.remove(),g(u,c)):T.empty().append(r),a(e.querySelectorAll("script")).each(function(){a.globalEval(this.text||this.textContent||this.innerHTML||"")})}else t.empty().append(e)}function g(t,e){var a=Math.min(e/800*1e3,1e3);setTimeout(function(){T.animate({height:t+1},a,"easeOutQuart",function(){T.css("height","auto")})},150)}function j(t){a(t).find(S).each(function(){var t=a(this);t.attr("href",t.attr("href")+"#issue-tabs")})}function y(t){!F||a.support.pjax?m(t):j(t)}function w(t){a(t).bind("moveToFinished",function(t,e){a("a.twixi:visible",e).focus()})}function x(t){t.find("time.livestamp").livestamp()}function k(t){a.inArray(t,_)<0&&_.push(t)}function A(){performance.mark("activityTabFullyLoaded")}var C,T,q,R=JIRA.Templates.Issue.Tabs,F=!1!==n.get("viewissue-use-history-api"),I="ajax-activity-content",J="#activitymodule div.mod-content",S=e.format("a.{0}",I),_=[];return k(l),k(y),k(w),k(o),k(x),k(A),{onTabReady:k,domReady:c}}),AJS.namespace("JIRA.ViewIssueTabs",null,require("jira/viewissue/tabs"));